{
  "entities": {
    "Account": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Account",
      "type": "object",
      "description": "Represents a user's primary account, linked to a unique email. One account can create an unlimited number of Member IDs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the account, matching Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "The unique email address for the account.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Defines the account's role and permissions (e.g., Super-admin, Member).",
          "enum": ["Super-admin", "Admin", "Developer", "Member"]
        },
        "verificationStatus": {
          "type": "string",
          "description": "The KYC verification state of the account: 'unverified', 'pending', 'verified'.",
          "enum": ["unverified", "pending", "verified"]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the account was created."
        }
      },
      "required": ["id", "email", "role", "verificationStatus", "createdAt"]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents a single digital identity (Member ID). Each Member ID is globally unique and belongs to an Account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this specific Member ID document."
        },
        "sequentialMemberId": {
          "type": "string",
          "description": "A human-readable, globally sequential ID assigned on creation (e.g., 'member.1')."
        },
        "accountId": {
          "type": "string",
          "description": "The ID of the Account that owns this Member ID. (Relationship: Account 1:N Member)"
        },
        "username": {
            "type": "string",
            "description": "Member's unique, public-facing username for this identity."
        },
        "usernameLastChanged": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of when the username was last changed, to enforce a cooldown."
        },
        "nickname": {
          "type": "string",
          "description": "Display nickname for this identity."
        },
        "avatar": {
          "type": "string",
          "description": "URL of the member's avatar image for this identity.",
          "format": "uri"
        },
        "level": {
          "type": "number",
          "description": "Membership level for this identity, which determines income potential."
        },
        "bio": {
          "type": "string",
          "description": "A short biography for this identity."
        },
        "walletId": {
          "type": "string",
          "description": "Reference to the Wallet for this Member ID. (Relationship: Member 1:1 Wallet)"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the Member ID was created."
        }
      },
      "required": ["id", "accountId", "username", "nickname", "level", "createdAt"]
    },
    "MesyMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MesyMember",
      "type": "object",
      "description": "Represents a verified MESY Member with special privileges.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The unique identifier of the user (matches Firebase Auth UID)."
        },
        "memberId": {
          "type": "number",
          "description": "Unique sequential ID for the MESY Member."
        },
        "email": {
          "type": "string",
          "description": "Member's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Public display name for the member."
        },
        "role": {
          "type": "string",
          "description": "Member's role (e.g., Owner, Super-admin, Admin)."
        },
        "joinedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the user became a MESY Member."
        }
      },
      "required": ["userId", "memberId", "email", "role", "joinedAt"]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores private user information linked to an Account, not a specific Member ID. Used for KYC and account management.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile entity, should match Account ID."
        },
        "accountId": {
          "type": "string",
          "description": "Reference to Account. (Relationship: UserProfile 1:1 Account)"
        },
        "firstname": {
            "type": "string",
            "description": "Account holder's legal first name."
        },
        "lastname": {
            "type": "string",
            "description": "Account holder's legal last name."
        },
        "phoneNumber": {
            "type": "object",
            "description": "Account holder's phone number, should be verified.",
            "properties": {
                "countryCode": { "type": "string", "description": "The international country calling code, e.g., '+66'." },
                "number": { "type": "string", "description": "The local phone number." }
            }
        },
        "nationalId": {
            "type": "string",
            "description": "Account holder's national identification number. Should be encrypted at rest and only accessible by authorized admins."
        },
        "address": {
            "type": "object",
            "description": "Account holder's physical address, for billing and verification.",
            "properties": {
                "street": { "type": "string" },
                "city": { "type": "string" },
                "region": { "type": "string", "description": "State, province, or region." },
                "postalCode": { "type": "string" },
                "country": { "type": "string" }
            }
        }
      },
      "required": [ "id", "accountId", "firstname", "lastname", "phoneNumber"]
    },
    "Downline": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Downline",
      "type": "object",
      "description": "Represents a member's downline member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the downline entity (same as the downline Member's ID)."
        },
        "uplineMemberId": {
          "type": "string",
          "description": "The ID of the member directly above this one in the hierarchy."
        },
        "username": {
          "type": "string",
          "description": "Username of the downline member."
        },
        "avatar": {
          "type": "string",
          "description": "URL of the downline member's avatar.",
          "format": "uri"
        },
        "level": {
          "type": "number",
          "description": "Membership level of the downline member."
        },
        "joinDate": {
          "type": "string",
          "description": "Date when the downline member joined."
        }
      },
      "required": [
        "id",
        "uplineMemberId",
        "username",
        "level",
        "joinDate"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification entity."
        },
        "accountId": {
          "type": "string",
          "description": "Reference to Account. (Relationship: Account 1:N Notification)"
        },
        "message": {
          "type": "string",
          "description": "Content of the notification message."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the notification was created.",
          "format": "date-time"
        },
        "read": {
          "type": "boolean",
          "description": "Indicates whether the notification has been read."
        }
      },
      "required": [
        "id",
        "accountId",
        "message",
        "createdAt",
        "read"
      ]
    },
    "Quest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quest",
      "type": "object",
      "description": "Represents a quest or challenge for a member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quest entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the quest."
        },
        "description": {
          "type": "string",
          "description": "Description of the quest."
        },
        "reward": {
          "type": "string",
          "description": "Description of the reward for completing the quest."
        },
        "status": {
          "type": "string",
          "description": "Current status of the quest (e.g., active, completed)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "reward",
        "status"
      ]
    },
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that can be earned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reward entity."
        },
        "type": {
          "type": "string",
          "description": "Type of reward (e.g., discount, bonus, item)."
        },
        "value": {
          "type": "number",
          "description": "Value of the reward."
        },
        "expiry": {
          "type": "string",
          "description": "Expiration date of the reward.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "type",
        "value",
        "expiry"
      ]
    },
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a store or marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the store entity."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to Member. (Relationship: Member 1:N Store) ID of the store owner."
        },
        "products": {
          "type": "array",
          "description": "Array of product IDs available in the store.",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the store (e.g., open, closed, pending)."
        }
      },
      "required": [
        "id",
        "ownerId",
        "products",
        "status"
      ]
    },
    "AiSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiSession",
      "type": "object",
      "description": "Represents a session of using the AI tools.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI session entity."
        },
        "memberId": {
          "type": "string",
          "description": "Reference to Member. (Relationship: Member 1:N AiSession) ID of the member who initiated the session."
        },
        "type": {
          "type": "string",
          "description": "Type of AI tool used (e.g., content generator, avatar generator)."
        },
        "input": {
          "type": "string",
          "description": "Input provided to the AI tool."
        },
        "output": {
          "type": "string",
          "description": "Output generated by the AI tool."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the AI session occurred.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "memberId",
        "type",
        "input",
        "output",
        "timestamp"
      ]
    },
    "Wallet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wallet",
      "type": "object",
      "description": "Represents a Member ID's wallet for managing in-app currency.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the wallet."
        },
        "memberId": {
          "type": "string",
          "description": "Reference to Member ID. (Relationship: Member 1:1 Wallet)"
        },
        "balance": {
          "type": "number",
          "description": "Current balance in the wallet."
        },
        "currency": {
          "type": "string",
          "description": "Type of currency used in the wallet."
        }
      },
      "required": [
        "id",
        "memberId",
        "balance",
        "currency"
      ]
    },
    "WalletTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wallet Transaction",
      "type": "object",
      "description": "Represents a single financial transaction within a member's wallet.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the transaction." },
        "walletId": { "type": "string", "description": "Reference to the Wallet. (Relationship: Wallet 1:N WalletTransaction)" },
        "type": {
          "type": "string",
          "description": "The type of transaction.",
          "enum": ["deposit", "withdrawal", "fee", "commission_income", "market_sale", "market_purchase", "quest_reward", "gift"]
        },
        "amount": { "type": "number", "description": "The transaction amount. Can be positive (income) or negative (expense)." },
        "description": { "type": "string", "description": "A brief description of the transaction, e.g., 'Monthly downline commission' or 'Purchase of Chrono Blade'." },
        "timestamp": { "type": "string", "format": "date-time", "description": "The exact time the transaction occurred." },
        "relatedEntityId": { "type": "string", "description": "Optional ID of a related entity, e.g., a product ID from a market purchase or a member ID from a gift." }
      },
      "required": ["id", "walletId", "type", "amount", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "accounts/{accountId}",
        "definition": {
          "entityName": "Account",
          "schema": { "$ref": "#/backend/entities/Account" },
          "description": "Stores primary user account information, linked to Firebase Auth."
        }
      },
      {
        "path": "accounts/{accountId}/profile/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": { "$ref": "#/backend/entities/UserProfile" },
          "description": "Stores private KYC data for an account."
        }
      },
      {
        "path": "accounts/{accountId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for an entire account."
        }
      },
      {
        "path": "members/{memberId}",
        "definition": {
          "entityName": "Member",
          "schema": { "$ref": "#/backend/entities/Member" },
          "description": "Globally unique digital identities. Each member is owned by an account."
        }
      },
      {
        "path": "members/{memberId}/downline/{downlineMemberId}",
        "definition": {
          "entityName": "Downline",
          "schema": { "$ref": "#/backend/entities/Downline" },
          "description": "Stores the direct downline for a specific Member ID."
        }
      },
      {
        "path": "members/{memberId}/ai_sessions/{sessionId}",
        "definition": {
          "entityName": "AiSession",
          "schema": {
            "$ref": "#/backend/entities/AiSession"
          },
          "description": "Stores AI session history for a specific Member ID."
        }
      },
      {
        "path": "members/{memberId}/wallet/{walletId}",
        "definition": {
          "entityName": "Wallet",
          "schema": {
            "$ref": "#/backend/entities/Wallet"
          },
          "description": "Stores wallet information for a specific Member ID."
        }
      },
      {
        "path": "members/{memberId}/wallet/{walletId}/transactions/{transactionId}",
        "definition": {
          "entityName": "WalletTransaction",
          "schema": { "$ref": "#/backend/entities/WalletTransaction" },
          "description": "Stores individual financial transactions for a specific Member ID's wallet."
        }
      },
      {
        "path": "quests/{questId}",
        "definition": {
          "entityName": "Quest",
          "schema": {
            "$ref": "#/backend/entities/Quest"
          },
          "description": "Stores quest information."
        }
      },
      {
        "path": "rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores reward information."
        }
      },
      {
        "path": "stores/{storeId}",
        "definition": {
          "entityName": "Store",
          "schema": {
            "$ref": "#/backend/entities/Store"
          },
          "description": "Stores store information."
        }
      }
    ],
    "reasoning": "The Firestore structure is re-architected for a global member system. A top-level `members` collection ensures each Member ID is globally unique and can have its own sequential ID. Each member document contains an `accountId` to link back to its owner. The `accounts` collection remains for user-specific, non-identity data like KYC info and notifications. This new structure better supports the global, sequential, and unlimited Member ID model."
  }
}
