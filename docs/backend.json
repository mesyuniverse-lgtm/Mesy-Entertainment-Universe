{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Mesy Entertainment Universe platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "User's role within the platform (User, Member, Admin, Super-admin, Developer)."
        },
        "level": {
          "type": "number",
          "description": "User's membership level."
        },
        "profileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: User 1:1 UserProfile)"
        },
        "walletId": {
          "type": "string",
          "description": "Reference to Wallet. (Relationship: User 1:1 Wallet)"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "level",
        "profileId",
        "walletId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents the profile information of a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: UserProfile 1:1 User)"
        },
        "nickname": {
          "type": "string",
          "description": "User's chosen nickname."
        },
        "bio": {
          "type": "string",
          "description": "User's biography."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the user's avatar image.",
          "format": "uri"
        },
        "socialLinks": {
          "type": "array",
          "description": "Links to user's social media profiles.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "nickname"
      ]
    },
    "Wallet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wallet",
      "type": "object",
      "description": "Represents a user's wallet for managing in-app currency and transactions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the wallet entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: Wallet 1:1 User)"
        },
        "balance": {
          "type": "number",
          "description": "Current balance in the user's wallet."
        }
      },
      "required": [
        "id",
        "userId",
        "balance"
      ]
    },
    "Downline": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Downline",
      "type": "object",
      "description": "Represents a user's downline members and their associated data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the downline entity."
        },
        "memberId": {
          "type": "string",
          "description": "Reference to User. (Relationship: Downline 1:N User)"
        },
        "username": {
          "type": "string",
          "description": "Username of the downline member."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the downline member's avatar image.",
          "format": "uri"
        },
        "level": {
          "type": "number",
          "description": "Membership level of the downline member."
        },
        "joinDate": {
          "type": "string",
          "description": "Date when the downline member joined.",
          "format": "date-time"
        },
        "stars": {
          "type": "number",
          "description": "Number of stars earned by the downline member."
        },
        "income": {
          "type": "number",
          "description": "Income generated by the downline member."
        }
      },
      "required": [
        "id",
        "memberId",
        "username",
        "level",
        "joinDate",
        "stars",
        "income"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: Notification 1:N User)"
        },
        "message": {
          "type": "string",
          "description": "Notification message."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the notification was created.",
          "format": "date-time"
        },
        "read": {
          "type": "boolean",
          "description": "Indicates whether the notification has been read."
        }
      },
      "required": [
        "id",
        "userId",
        "message",
        "createdAt",
        "read"
      ]
    },
    "Quest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quest",
      "type": "object",
      "description": "Represents a quest that a user can undertake.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quest entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the quest."
        },
        "description": {
          "type": "string",
          "description": "Description of the quest."
        },
        "reward": {
          "type": "string",
          "description": "Reward for completing the quest."
        },
        "status": {
          "type": "string",
          "description": "Status of the quest (e.g., active, completed, failed)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "reward",
        "status"
      ]
    },
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that a user can receive.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reward entity."
        },
        "type": {
          "type": "string",
          "description": "Type of reward (e.g., in-app currency, discount)."
        },
        "value": {
          "type": "number",
          "description": "Value of the reward."
        },
        "expiry": {
          "type": "string",
          "description": "Expiration date of the reward.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "type",
        "value",
        "expiry"
      ]
    },
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a store within the platform where users can buy and sell products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the store entity."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: Store 1:N User)"
        },
        "productIds": {
          "type": "array",
          "description": "References to Products. (Relationship: Store 1:N Product)",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the store (e.g., open, closed, suspended)."
        }
      },
      "required": [
        "id",
        "ownerId",
        "productIds",
        "status"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product that is sold in a store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product entity."
        },
        "storeId": {
          "type": "string",
          "description": "Reference to Store. (Relationship: Product N:1 Store)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        }
      },
      "required": [
        "id",
        "storeId",
        "name",
        "description",
        "price"
      ]
    },
    "AiSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiSession",
      "type": "object",
      "description": "Represents a session of using an AI tool.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI session entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: AiSession 1:N User)"
        },
        "type": {
          "type": "string",
          "description": "Type of AI tool used (e.g., content generator, avatar generator)."
        },
        "input": {
          "type": "string",
          "description": "Input provided to the AI tool."
        },
        "output": {
          "type": "string",
          "description": "Output generated by the AI tool."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the AI session occurred.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "input",
        "output",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information.  Includes 'role' for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data.  Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wallet",
        "definition": {
          "entityName": "Wallet",
          "schema": {
            "$ref": "#/backend/entities/Wallet"
          },
          "description": "Stores user wallet information. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/downline/{downlineId}",
        "definition": {
          "entityName": "Downline",
          "schema": {
            "$ref": "#/backend/entities/Downline"
          },
          "description": "Stores downline member data for a user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "downlineId",
              "description": "The unique identifier for the downline member."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for a user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      },
      {
        "path": "/quests/{questId}",
        "definition": {
          "entityName": "Quest",
          "schema": {
            "$ref": "#/backend/entities/Quest"
          },
          "description": "Stores quest data.",
          "params": [
            {
              "name": "questId",
              "description": "The unique identifier for the quest."
            }
          ]
        }
      },
      {
        "path": "/rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores reward data.",
          "params": [
            {
              "name": "rewardId",
              "description": "The unique identifier for the reward."
            }
          ]
        }
      },
      {
        "path": "/stores/{storeId}",
        "definition": {
          "entityName": "Store",
          "schema": {
            "$ref": "#/backend/entities/Store"
          },
          "description": "Stores store data.",
          "params": [
            {
              "name": "storeId",
              "description": "The unique identifier for the store."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product data.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/ai_sessions/{aiSessionId}",
        "definition": {
          "entityName": "AiSession",
          "schema": {
            "$ref": "#/backend/entities/AiSession"
          },
          "description": "Stores AI session data for a user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "aiSessionId",
              "description": "The unique identifier for the AI session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to provide a secure, scalable, and debuggable system for the Mesy Entertainment Universe. It adheres to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Rules are not Filters), and Invariants.\n\n**Authorization Independence:**  The design avoids hierarchical authorization dependencies (`get()`) by denormalizing authorization context. For instance, if access to `notifications` depends on user roles, that role information will be copied or mirrored into the notification document itself. This ensures that security rules can be evaluated without needing to fetch parent documents, enabling atomic operations and easier debugging.\n\n**Structural Segregation:** Collections are structured to ensure that all documents within a collection share the same security requirements.  For example, user-specific data is stored under `/users/{userId}`. This avoids mixing data with different access needs in the same collection, simplifying security rules.\n\n**Access Modeling:**\n*   **Private Data:** User-owned data (profile, wallet, notifications, AI sessions) is stored using path-based ownership (`/users/{userId}/{entity}`).\n*   **Collaborative Data:** N/A\n*   **Global Roles:** User roles are stored directly on the `user` document under `/users/{userId}`.\n\n**QAPs Support:** The structure supports secure `list` operations by using structural segregation and path-based ownership. For example, listing notifications is secured by ensuring that only the user with the corresponding `userId` can access `/users/{userId}/notifications`.  Admin roles can be verified by checking the `role` field on the user document located at `/users/{userId}` which can be done without inefficient collection group queries.\n\n**Invariants:** The structure supports data integrity by enforcing ownership, timestamps, and denormalized data. For example, the `userId` in the `/users/{userId}/notifications` subcollection ensures that each notification belongs to the correct user.\n"
  }
}